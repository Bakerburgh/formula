<!DOCTYPE html>

<html>
<head>
  <title>compile.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="abs.html">
                  abs.js
                </a>
              
                
                <a class="source" href="acos.html">
                  acos.js
                </a>
              
                
                <a class="source" href="add.html">
                  add.js
                </a>
              
                
                <a class="source" href="address.html">
                  address.js
                </a>
              
                
                <a class="source" href="and.html">
                  and.js
                </a>
              
                
                <a class="source" href="average.html">
                  average.js
                </a>
              
                
                <a class="source" href="bin2dec.html">
                  bin2dec.js
                </a>
              
                
                <a class="source" href="branch.html">
                  branch.js
                </a>
              
                
                <a class="source" href="cellindex.html">
                  cellindex.js
                </a>
              
                
                <a class="source" href="changed.html">
                  changed.js
                </a>
              
                
                <a class="source" href="char.html">
                  char.js
                </a>
              
                
                <a class="source" href="choose.html">
                  choose.js
                </a>
              
                
                <a class="source" href="clean.html">
                  clean.js
                </a>
              
                
                <a class="source" href="code.html">
                  code.js
                </a>
              
                
                <a class="source" href="column.html">
                  column.js
                </a>
              
                
                <a class="source" href="columnletter.html">
                  columnletter.js
                </a>
              
                
                <a class="source" href="columnnumber.html">
                  columnnumber.js
                </a>
              
                
                <a class="source" href="compile.html">
                  compile.js
                </a>
              
                
                <a class="source" href="concatenate.html">
                  concatenate.js
                </a>
              
                
                <a class="source" href="constants.html">
                  constants.js
                </a>
              
                
                <a class="source" href="cos.html">
                  cos.js
                </a>
              
                
                <a class="source" href="date.html">
                  date.js
                </a>
              
                
                <a class="source" href="datedif.html">
                  datedif.js
                </a>
              
                
                <a class="source" href="datevalue.html">
                  datevalue.js
                </a>
              
                
                <a class="source" href="day.html">
                  day.js
                </a>
              
                
                <a class="source" href="days360.html">
                  days360.js
                </a>
              
                
                <a class="source" href="dec2bin.html">
                  dec2bin.js
                </a>
              
                
                <a class="source" href="decodebase64.html">
                  decodebase64.js
                </a>
              
                
                <a class="source" href="decodejwt.html">
                  decodejwt.js
                </a>
              
                
                <a class="source" href="diff.html">
                  diff.js
                </a>
              
                
                <a class="source" href="divide.html">
                  divide.js
                </a>
              
                
                <a class="source" href="edate.html">
                  edate.js
                </a>
              
                
                <a class="source" href="eomonth.html">
                  eomonth.js
                </a>
              
                
                <a class="source" href="eq.html">
                  eq.js
                </a>
              
                
                <a class="source" href="error.html">
                  error.js
                </a>
              
                
                <a class="source" href="exact.html">
                  exact.js
                </a>
              
                
                <a class="source" href="filter.html">
                  filter.js
                </a>
              
                
                <a class="source" href="find.html">
                  find.js
                </a>
              
                
                <a class="source" href="flatten.html">
                  flatten.js
                </a>
              
                
                <a class="source" href="functions.html">
                  functions.js
                </a>
              
                
                <a class="source" href="fv.html">
                  fv.js
                </a>
              
                
                <a class="source" href="get.html">
                  get.js
                </a>
              
                
                <a class="source" href="group.html">
                  group.js
                </a>
              
                
                <a class="source" href="gt.html">
                  gt.js
                </a>
              
                
                <a class="source" href="gte.html">
                  gte.js
                </a>
              
                
                <a class="source" href="guid.html">
                  guid.js
                </a>
              
                
                <a class="source" href="hlookup.html">
                  hlookup.js
                </a>
              
                
                <a class="source" href="hour.html">
                  hour.js
                </a>
              
                
                <a class="source" href="ifblank.html">
                  ifblank.js
                </a>
              
                
                <a class="source" href="ifempty.html">
                  ifempty.js
                </a>
              
                
                <a class="source" href="iferror.html">
                  iferror.js
                </a>
              
                
                <a class="source" href="ifna.html">
                  ifna.js
                </a>
              
                
                <a class="source" href="includes.html">
                  includes.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
                
                <a class="source" href="index2col.html">
                  index2col.js
                </a>
              
                
                <a class="source" href="index2row.html">
                  index2row.js
                </a>
              
                
                <a class="source" href="int.html">
                  int.js
                </a>
              
                
                <a class="source" href="isarray.html">
                  isarray.js
                </a>
              
                
                <a class="source" href="isbinary.html">
                  isbinary.js
                </a>
              
                
                <a class="source" href="isblank.html">
                  isblank.js
                </a>
              
                
                <a class="source" href="isboolean.html">
                  isboolean.js
                </a>
              
                
                <a class="source" href="isdate.html">
                  isdate.js
                </a>
              
                
                <a class="source" href="isemail.html">
                  isemail.js
                </a>
              
                
                <a class="source" href="isempty.html">
                  isempty.js
                </a>
              
                
                <a class="source" href="iserr.html">
                  iserr.js
                </a>
              
                
                <a class="source" href="iserror.html">
                  iserror.js
                </a>
              
                
                <a class="source" href="iseven.html">
                  iseven.js
                </a>
              
                
                <a class="source" href="isfalsy.html">
                  isfalsy.js
                </a>
              
                
                <a class="source" href="isfunction.html">
                  isfunction.js
                </a>
              
                
                <a class="source" href="isleapyear.html">
                  isleapyear.js
                </a>
              
                
                <a class="source" href="isna.html">
                  isna.js
                </a>
              
                
                <a class="source" href="isnumber.html">
                  isnumber.js
                </a>
              
                
                <a class="source" href="isobject.html">
                  isobject.js
                </a>
              
                
                <a class="source" href="isodd.html">
                  isodd.js
                </a>
              
                
                <a class="source" href="isoweeknum.html">
                  isoweeknum.js
                </a>
              
                
                <a class="source" href="isref.html">
                  isref.js
                </a>
              
                
                <a class="source" href="istext.html">
                  istext.js
                </a>
              
                
                <a class="source" href="istruthy.html">
                  istruthy.js
                </a>
              
                
                <a class="source" href="isurl.html">
                  isurl.js
                </a>
              
                
                <a class="source" href="iswholenumber.html">
                  iswholenumber.js
                </a>
              
                
                <a class="source" href="join.html">
                  join.js
                </a>
              
                
                <a class="source" href="left.html">
                  left.js
                </a>
              
                
                <a class="source" href="len.html">
                  len.js
                </a>
              
                
                <a class="source" href="lookup.html">
                  lookup.js
                </a>
              
                
                <a class="source" href="lower.html">
                  lower.js
                </a>
              
                
                <a class="source" href="lt.html">
                  lt.js
                </a>
              
                
                <a class="source" href="lte.html">
                  lte.js
                </a>
              
                
                <a class="source" href="map.html">
                  map.js
                </a>
              
                
                <a class="source" href="match.html">
                  match.js
                </a>
              
                
                <a class="source" href="max.html">
                  max.js
                </a>
              
                
                <a class="source" href="merge.html">
                  merge.js
                </a>
              
                
                <a class="source" href="min.html">
                  min.js
                </a>
              
                
                <a class="source" href="minute.html">
                  minute.js
                </a>
              
                
                <a class="source" href="month.html">
                  month.js
                </a>
              
                
                <a class="source" href="multiply.html">
                  multiply.js
                </a>
              
                
                <a class="source" href="n.html">
                  n.js
                </a>
              
                
                <a class="source" href="ne.html">
                  ne.js
                </a>
              
                
                <a class="source" href="not.html">
                  not.js
                </a>
              
                
                <a class="source" href="now.html">
                  now.js
                </a>
              
                
                <a class="source" href="nper.html">
                  nper.js
                </a>
              
                
                <a class="source" href="npv.html">
                  npv.js
                </a>
              
                
                <a class="source" href="numbers.html">
                  numbers.js
                </a>
              
                
                <a class="source" href="numbervalue.html">
                  numbervalue.js
                </a>
              
                
                <a class="source" href="oct2dec.html">
                  oct2dec.js
                </a>
              
                
                <a class="source" href="or.html">
                  or.js
                </a>
              
                
                <a class="source" href="parsebool.html">
                  parsebool.js
                </a>
              
                
                <a class="source" href="parsedate.html">
                  parsedate.js
                </a>
              
                
                <a class="source" href="parsequery.html">
                  parsequery.js
                </a>
              
                
                <a class="source" href="pi.html">
                  pi.js
                </a>
              
                
                <a class="source" href="pluck.html">
                  pluck.js
                </a>
              
                
                <a class="source" href="pmt.html">
                  pmt.js
                </a>
              
                
                <a class="source" href="power.html">
                  power.js
                </a>
              
                
                <a class="source" href="proper.html">
                  proper.js
                </a>
              
                
                <a class="source" href="pv.html">
                  pv.js
                </a>
              
                
                <a class="source" href="query.html">
                  query.js
                </a>
              
                
                <a class="source" href="reduce.html">
                  reduce.js
                </a>
              
                
                <a class="source" href="ref.html">
                  ref.js
                </a>
              
                
                <a class="source" href="replace.html">
                  replace.js
                </a>
              
                
                <a class="source" href="rept.html">
                  rept.js
                </a>
              
                
                <a class="source" href="right.html">
                  right.js
                </a>
              
                
                <a class="source" href="round.html">
                  round.js
                </a>
              
                
                <a class="source" href="roundup.html">
                  roundup.js
                </a>
              
                
                <a class="source" href="run.html">
                  run.js
                </a>
              
                
                <a class="source" href="search.html">
                  search.js
                </a>
              
                
                <a class="source" href="second.html">
                  second.js
                </a>
              
                
                <a class="source" href="select.html">
                  select.js
                </a>
              
                
                <a class="source" href="serial.html">
                  serial.js
                </a>
              
                
                <a class="source" href="sin.html">
                  sin.js
                </a>
              
                
                <a class="source" href="some.html">
                  some.js
                </a>
              
                
                <a class="source" href="sort.html">
                  sort.js
                </a>
              
                
                <a class="source" href="split.html">
                  split.js
                </a>
              
                
                <a class="source" href="substitute.html">
                  substitute.js
                </a>
              
                
                <a class="source" href="substituteAll.html">
                  substituteAll.js
                </a>
              
                
                <a class="source" href="subtract.html">
                  subtract.js
                </a>
              
                
                <a class="source" href="sum.html">
                  sum.js
                </a>
              
                
                <a class="source" href="surroundKeys.html">
                  surroundKeys.js
                </a>
              
                
                <a class="source" href="tan.html">
                  tan.js
                </a>
              
                
                <a class="source" href="tau.html">
                  tau.js
                </a>
              
                
                <a class="source" href="text.html">
                  text.js
                </a>
              
                
                <a class="source" href="time.html">
                  time.js
                </a>
              
                
                <a class="source" href="timevalue.html">
                  timevalue.js
                </a>
              
                
                <a class="source" href="today.html">
                  today.js
                </a>
              
                
                <a class="source" href="trim.html">
                  trim.js
                </a>
              
                
                <a class="source" href="trunc.html">
                  trunc.js
                </a>
              
                
                <a class="source" href="unique.html">
                  unique.js
                </a>
              
                
                <a class="source" href="upper.html">
                  upper.js
                </a>
              
                
                <a class="source" href="vlookup.html">
                  vlookup.js
                </a>
              
                
                <a class="source" href="xor.html">
                  xor.js
                </a>
              
                
                <a class="source" href="year.html">
                  year.js
                </a>
              
                
                <a class="source" href="yearfrac.html">
                  yearfrac.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>compile.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>Copyright 2015 Peter W Moresi</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">import</span> {parser} <span class="hljs-keyword">from</span> <span class="hljs-string">'./parser'</span>

<span class="hljs-keyword">var</span> compiledNumber = <span class="hljs-number">0</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span>(<span class="hljs-params">exp</span>) </span>{
  <span class="hljs-keyword">var</span> ast = exp,
      jsCode,
      functionCode,
      f,
      suppress = <span class="hljs-literal">false</span>,
      precedents = [],
      requires = [],
      namespace=<span class="hljs-string">'funcs.'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>convert to AST when string provided</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ast === <span class="hljs-string">'string'</span>) {
    ast = parser.parse(exp);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapString</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">if</span> (s[<span class="hljs-number">0</span>] == <span class="hljs-string">"'"</span> &amp;&amp; s[s.length<span class="hljs-number">-1</span>] === <span class="hljs-string">"'"</span>) {
      <span class="hljs-keyword">return</span> s;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">'\''</span> + s + <span class="hljs-string">'\''</span>;
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printFuncs</span>(<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> items.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>)</span>{
      <span class="hljs-keyword">return</span> <span class="hljs-string">'function() { return ('</span> + compiler( n ) + <span class="hljs-string">') }'</span>;
    }).join(<span class="hljs-string">', '</span>)
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printItems</span>(<span class="hljs-params">items</span>) </span>{
    <span class="hljs-keyword">return</span> items.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>)</span>{
      <span class="hljs-keyword">return</span> compiler( n );
    }).join(<span class="hljs-string">', '</span>)
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>define a compiler function to handle recurse the AST.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compiler</span>(<span class="hljs-params"> node </span>) </span>{

    <span class="hljs-keyword">let</span> lhs, rhs;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The node is expected to be either an operator, function or a value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">switch</span>(node.type) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'operator'</span>:
        <span class="hljs-keyword">switch</span>(node.subtype) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">'prefix-plus'</span>:
            <span class="hljs-keyword">return</span> namespace + <span class="hljs-string">"numbervalue("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'prefix-minus'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"-"</span> + namespace + <span class="hljs-string">"numbervalue("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-add'</span>:
            requires.push(<span class="hljs-string">'add'</span>);
            <span class="hljs-keyword">return</span> namespace + <span class="hljs-string">"add("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-subtract'</span>:
            requires.push(<span class="hljs-string">'subtract'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"subtract("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-multiply'</span>:
            requires.push(<span class="hljs-string">'multiply'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"multiply("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-divide'</span>:
            requires.push(<span class="hljs-string">'divide'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"divide("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-power'</span>:
            requires.push(<span class="hljs-string">'power'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">'power('</span> + printItems(node.operands) + <span class="hljs-string">')'</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-concat'</span>:
            requires.push(<span class="hljs-string">'concatenate'</span>);
            <span class="hljs-keyword">return</span> namespace + <span class="hljs-string">"concatenate("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>;
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-eq'</span>:
            requires.push(<span class="hljs-string">'eq'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"eq("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-ne'</span>:
            requires.push(<span class="hljs-string">'ne'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"ne("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-gt'</span>:
            requires.push(<span class="hljs-string">'gt'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"gt("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-gte'</span>:
            requires.push(<span class="hljs-string">'gte'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"gte("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-lt'</span>:
            requires.push(<span class="hljs-string">'lt'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"lt("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'infix-lte'</span>:
            requires.push(<span class="hljs-string">'lte'</span>);
            <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">"lte("</span> + printItems(node.operands) + <span class="hljs-string">")"</span>);
        }
        <span class="hljs-keyword">throw</span> TypeException(<span class="hljs-string">"Unknown operator: "</span> + node.subtype);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'group'</span>:
        <span class="hljs-keyword">return</span> (<span class="hljs-string">'('</span> +  compiler( node.exp ) + <span class="hljs-string">')'</span>);
      <span class="hljs-keyword">case</span> <span class="hljs-string">'function'</span>:
      requires.push(node.name.toLowerCase() === <span class="hljs-string">'if'</span> ? <span class="hljs-string">'branch'</span> : node.name.toLowerCase());
      <span class="hljs-keyword">switch</span>(node.name.toLowerCase()) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'if'</span>:
        <span class="hljs-keyword">return</span> (namespace + <span class="hljs-string">'branch( '</span> + printFuncs(node.args) + <span class="hljs-string">' )'</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'and'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'or'</span>:
        <span class="hljs-keyword">return</span> (namespace + node.name.toLowerCase() + <span class="hljs-string">'( '</span> + printFuncs(node.args) + <span class="hljs-string">' )'</span>);
        <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">return</span> (namespace + node.name.toLowerCase() + <span class="hljs-string">'( '</span> + printItems(node.args) + <span class="hljs-string">' )'</span>);
      }
      <span class="hljs-keyword">case</span> <span class="hljs-string">'cell'</span>:
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> precedents !== <span class="hljs-string">"undefined"</span> &amp;&amp; !suppress) { precedents.push(node); }

        <span class="hljs-keyword">return</span> <span class="hljs-string">'context.get(\"'</span> + node.addr + <span class="hljs-string">'\")'</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">'range'</span>:

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> precedents !== <span class="hljs-string">"undefined"</span>) { precedents.push(node); suppress = <span class="hljs-literal">true</span>; }
        lhs = compiler(node.topLeft);
        rhs = compiler(node.bottomRight);
        suppress = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>anonymous functions are the perfect solution for dynamic ranges but was not immediately obvious to me</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ( node.topLeft.type === <span class="hljs-string">"function"</span> ) {
          lhs = <span class="hljs-string">"function() { return ("</span> + lhs + <span class="hljs-string">"); }"</span>
        }

        <span class="hljs-keyword">if</span> ( node.bottomRight.type === <span class="hljs-string">"function"</span> ) {
          rhs = <span class="hljs-string">"function() { return ("</span> + rhs + <span class="hljs-string">"); }"</span>
        }

        requires.push(<span class="hljs-string">'ref'</span>);
        <span class="hljs-keyword">return</span> (<span class="hljs-string">'this.ref( '</span> + lhs + <span class="hljs-string">', '</span> + rhs + <span class="hljs-string">' )'</span> );

      <span class="hljs-keyword">case</span> <span class="hljs-string">'variable'</span>:
        <span class="hljs-keyword">if</span> (precedents &amp;&amp; !suppress) { precedents.push(node); }
        <span class="hljs-keyword">if</span> (  node.scope) {
          <span class="hljs-keyword">return</span> <span class="hljs-string">'context.get(\"'</span> + node.name + <span class="hljs-string">'\", \"'</span> + node.scope + <span class="hljs-string">'\")'</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">'context.get(\"'</span> + node.name + <span class="hljs-string">'\")'</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'value'</span>:
        <span class="hljs-keyword">switch</span> (node.subtype) {
          <span class="hljs-keyword">case</span> <span class="hljs-string">'array'</span>:
            <span class="hljs-keyword">return</span> (<span class="hljs-string">'['</span> + printItems(node.items) + <span class="hljs-string">']'</span>);
          <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
            <span class="hljs-keyword">return</span> <span class="hljs-string">"'"</span> + node.value.replace(<span class="hljs-regexp">/'/g</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'"</span>;

          <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">return</span> node.value;
        }
    }
  }

  <span class="hljs-keyword">var</span> id = compiledNumber++;

  <span class="hljs-keyword">var</span> compiled = compiler(ast);

  f = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">'context'</span>, <span class="hljs-string">'funcs'</span>,
<span class="hljs-string">`/* formula: <span class="hljs-subst">${exp}</span> */
return (<span class="hljs-subst">${compiled}</span>);
</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h1 id="sourceurl-formula_-id-">sourceURL=formula_${id}</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-string">`
  );

  f.id = id;
  f.exp = exp;
  f.ast = ast;
  f.code = compiled;
  f.precedents = precedents;
  f.requires = requires;

  return f

}

</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
